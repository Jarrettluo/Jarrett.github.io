{"title":"mm-wiki的packets.go:36: unexpected EOF解决","uid":"62d76556d121d2872e8a9782563ea5e2","slug":"mm-wiki的packets-go-36-unexpected-EOF解决","date":"2021-11-14T06:10:32.000Z","updated":"2021-11-14T06:24:50.805Z","comments":true,"path":"api/articles/mm-wiki的packets-go-36-unexpected-EOF解决.json","keywords":null,"cover":"http://h2.ioliu.cn/bing/YorkMinster_ZH-CN3129176050_1920x1080.jpg","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>MM-Wiki 是一个轻量级的企业知识分享与团队协同软件，可用于快速构建企业 Wiki 和团队知识分享平台。部署方便，使用简单，帮助团队构建一个信息共享、文档管理的协作环境。<br><a href=\"https://github.com/phachon/mm-wiki\">https://github.com/phachon/mm-wiki</a></p>\n<p>某天服务器磁盘满了以后，出现已经登录的用户会闪退回登录界面的问题。以下是debug的过程。</p>\n<h1 id=\"环境介绍\"><a href=\"#环境介绍\" class=\"headerlink\" title=\"环境介绍\"></a>环境介绍</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">Linux 18.04\nmm-wiki 0.2.1\nmysql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"问题排查\"><a href=\"#问题排查\" class=\"headerlink\" title=\"问题排查\"></a>问题排查</h1><p>在mm-wiki的</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">mm_wiki\n├── logs\n│    └──mm-wiki.logs\n└──nohup.out<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"./mm-wiki%E7%9A%84packets-go-36-unexpected-EOF%E8%A7%A3%E5%86%B3/01.png\" alt=\"日志页面\"></p>\n<h1 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h1><p>在网上查找该问题，发现是go-sql-driver的问题，而且有人给出了解决办法。<br><img src=\"./mm-wiki%E7%9A%84packets-go-36-unexpected-EOF%E8%A7%A3%E5%86%B3/02.png\" alt=\"连接器的issues页面\"></p>\n<p>在该issure下出现的回打如下，就是将最大空闲链接设置为0。<br><img src=\"./mm-wiki%E7%9A%84packets-go-36-unexpected-EOF%E8%A7%A3%E5%86%B3/03.png\" alt=\"连接器的issues页面\"></p>\n<p>查找网上的设置方法: SetMaxIdleConns<br>默认情况下 sql.DB 会在链接池中最多保留 2 个空闲链接。可以通过 SetMaxIdleConns() 方法更改此方法，如下所示:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; 初始化一个新的链接池\ndb, err :&#x3D; sql.Open(&quot;postgres&quot;, &quot;postgres:&#x2F;&#x2F;user:pass@localhost&#x2F;db&quot;)\nif err !&#x3D; nil &#123;\n    log.Fatal(err)\n&#125;\n\n&#x2F;&#x2F; 将最大并发空闲链接数设置为 5.\n&#x2F;&#x2F; 小于或等于 0 表示不保留任何空闲链接.\ndb.SetMaxIdleConns(5)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>Stack overflow 提供的解决办法也是将<code>MaxIdleConnections</code>修改为0就解决该问题。<a href=\"https://stackoverflow.com/questions/39980902/golang-mysql-error-packets-go33-unexpected-eof\">https://stackoverflow.com/questions/39980902/golang-mysql-error-packets-go33-unexpected-eof</a></p>\n<p>针对mm-wiki的解决方法如下。<br>首先找到配置文件，所在路径为<code>mm_wiki/conf/mm-wiki.conf</code></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ cd &#x2F;mm_wiki&#x2F;conf&#x2F;\n$ sudo nano mm  mm-wiki.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>将其中的<code>conn_max_idle</code>修改为0。然后<code>ctrl + x</code>保存文件后退出。<br><img src=\"https://upload-images.jianshu.io/upload_images/20506226-b5ab7cd659254ca2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"配置文件\"></p>\n<p>修改完毕以后，尝试启动项目：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$ .&#x2F;mm-wiki --conf conf&#x2F;mm-wiki.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>如果启动成功可以使用nohup将项目挂载起来。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$ nohup .&#x2F;mm-wiki --conf conf&#x2F;mm-wiki.conf &amp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>系统设计的时候，也应该有个conf文件，避免debug的时候需要重新编译和打包，这种设计方案可以在生产环境中直接重启，让配置生效。</p>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><ul>\n<li><a href=\"https://www.alexedwards.net/blog/configuring-sqldb\">如何配置 sql.DB 的 SetMaxOpenConns SetMaxIdleConns 和 SetConnMaxLifetime</a></li>\n</ul>\n","feature":true,"text":"背景MM-Wiki 是一个轻量级的企业知识分享与团队协同软件，可用于快速构建企业 Wiki 和团队知识分享平台。部署方便，使用简单，帮助团队构建一个信息共享、文档管理的协作环境。https://github.com/phachon/mm-wiki 某天服务器磁盘满了以后，出现已经...","link":"","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"debug","slug":"debug","count":2,"path":"api/categories/debug.json"}],"tags":[{"name":"go","slug":"go","count":1,"path":"api/tags/go.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">背景</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">环境介绍</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5\"><span class=\"toc-text\">问题排查</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">解决问题</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3\"><span class=\"toc-text\">参考文档</span></a></li></ol>","author":{"name":"JIARUI's BLOG","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17515212?s=400&u=3dc2bbf2e6239369be5c37d357699a46d94404c9&v=4","link":"/","description":"数据应用大师Master <br /> <b>谋时而动 顺势而为</b>","socials":{"github":"https://github.com/Jarrettluo","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/luo-jia-rui","csdn":"https://blog.csdn.net/JarrettLuo","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"我写了一个Flask-restful的快速模板","uid":"2a565706375e8204a992e2f354c7a89e","slug":"我写了一个Flask-restful的快速模板","date":"2021-11-14T06:13:45.000Z","updated":"2021-11-14T06:29:45.126Z","comments":true,"path":"api/articles/我写了一个Flask-restful的快速模板.json","keywords":null,"cover":"http://h2.ioliu.cn/bing/Neowise_ZH-CN1308687945_1920x1080.jpg","text":"前言前几天在进行项目开发的时候，发现用Flask写一些轻量化的Web程序还是比较合适的。其实在Flask家族中，为了能够更加方便的开发Restful风格的接口，Flask-restful是一个不错的选择。虽然Flask-restful提供了比较完整的官方文档，但是距离开发上线项目...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"Mysql","slug":"Mysql","count":2,"path":"api/tags/Mysql.json"},{"name":"Python","slug":"Python","count":1,"path":"api/tags/Python.json"},{"name":"Flask","slug":"Flask","count":1,"path":"api/tags/Flask.json"}],"author":{"name":"JIARUI's BLOG","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17515212?s=400&u=3dc2bbf2e6239369be5c37d357699a46d94404c9&v=4","link":"/","description":"数据应用大师Master <br /> <b>谋时而动 顺势而为</b>","socials":{"github":"https://github.com/Jarrettluo","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/luo-jia-rui","csdn":"https://blog.csdn.net/JarrettLuo","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Docker应用连接TDengine数据库的解决方案","uid":"e1808551f050f3a6ba3836556587dcae","slug":"Docker应用连接TDengine数据库的解决方案","date":"2021-11-03T11:20:11.000Z","updated":"2021-11-14T06:26:36.239Z","comments":true,"path":"api/articles/Docker应用连接TDengine数据库的解决方案.json","keywords":null,"cover":"http://h2.ioliu.cn/bing/NewtonPumpkins_ZH-CN2560195971_1920x1080.jpg","text":"1、工作环境开发工具：IDEA，安装插件docker TDengine Version：2.0.20.5 taos jdbc Version: 2.0.22 Springboot Version: 2.4.5 Docker Version： 20.10.10 2、Dockerfi...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"后端开发","slug":"后端开发","count":1,"path":"api/categories/后端开发.json"}],"tags":[{"name":"docker","slug":"docker","count":1,"path":"api/tags/docker.json"},{"name":"TDengine","slug":"TDengine","count":1,"path":"api/tags/TDengine.json"}],"author":{"name":"JIARUI's BLOG","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17515212?s=400&u=3dc2bbf2e6239369be5c37d357699a46d94404c9&v=4","link":"/","description":"数据应用大师Master <br /> <b>谋时而动 顺势而为</b>","socials":{"github":"https://github.com/Jarrettluo","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/luo-jia-rui","csdn":"https://blog.csdn.net/JarrettLuo","juejin":"","customs":{}}},"feature":true}}